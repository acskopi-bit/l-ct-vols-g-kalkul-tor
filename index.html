<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<title>Tetőléc kiosztó kalkulátor (cm, 3 tizedes, ±1 cm rugalmasság)</title>
<style>
body { font-family: Arial; max-width: 700px; margin: auto; padding: 20px; }
label { display: block; margin-top: 10px; }
input { width: 100%; padding: 5px; margin-top: 5px; }
button { margin-top: 15px; padding: 10px; width: 100%; font-size: 16px; }
#result { margin-top: 20px; white-space: pre-wrap; }
canvas { border: 1px solid #aaa; margin-top: 20px; width: 100%; }
</style>
</head>
<body>

<h2>Tetőléc kiosztó kalkulátor</h2>

<label>Kezdőléc MIN (cm)</label>
<input type="number" id="kezdoMin" step="0.001">

<label>Kezdőléc MAX (cm)</label>
<input type="number" id="kezdoMax" step="0.001">

<label>Léctávolság MIN (cm)</label>
<input type="number" id="lecMin" step="0.001">

<label>Léctávolság MAX (cm)</label>
<input type="number" id="lecMax" step="0.001">

<label>Szarufa hossza (cm)</label>
<input type="number" id="szarufa" step="0.001">

<label>Utolsó léc távolsága a gerinctől (cm)</label>
<input type="number" id="lastDist" step="0.001">

<button onclick="szamol()">Kiosztás számítása</button>

<h3>Eredmény</h3>
<div id="result"></div>

<canvas id="rajz" height="400"></canvas>

<script>
function szamol() {
    const kezdoMin = parseFloat(kezdoMinEl.value);
    const kezdoMax = parseFloat(kezdoMaxEl.value);
    const lecMin = parseFloat(lecMinEl.value);
    const lecMax = parseFloat(lecMaxEl.value);
    const szarufa = parseFloat(szarufaEl.value);
    const lastDist = parseFloat(lastDistEl.value);

    const tolerance = 1.0; // ±1 cm rugalmasság

    let output = "";

    let optimal = null;
    let positions = [];
    let bestDiff = Infinity;

    for (let kezdo = kezdoMax; kezdo >= kezdoMin; kezdo = parseFloat((kezdo - 0.001).toFixed(3))) {
        for (let lec = lecMin; lec <= lecMax; lec = parseFloat((lec + 0.001).toFixed(3))) {

            let pos = [];
            let y = kezdo;

            while (y + lec <= szarufa) {
                pos.push(y);
                y += lec;
            }

            if(pos.length === 0) continue;

            const last = szarufa - pos[pos.length - 1];
            const diff = Math.abs(last - lastDist);

            if (diff <= tolerance && diff < bestDiff) {
                optimal = { kezdo, lec };
                positions = pos;
                bestDiff = diff;
            }
        }
    }

    if (!optimal) {
        result.innerText = "Nincs megfelelő kiosztás!";
        return;
    }

    output += `Kezdőléc: ${optimal.kezdo.toFixed(3)} cm\n`;
    output += `Léctávolság: ${optimal.lec.toFixed(3)} cm\n`;
    output += `Lécpozíciók (cm):\n`;
    positions.forEach((p, i) => {
        output += `${i+1}. léc: ${p.toFixed(3)} cm\n`;
    });
    const lastCalc = szarufa - positions[positions.length - 1];
    output += `Utolsó léc távolsága a gerinctől: ${lastCalc.toFixed(3)} cm`;

    result.innerText = output;

    draw(positions, szarufa);
}

function draw(pos, full) {
    const canvas = document.getElementById("rajz");
    const ctx = canvas.getContext("2d");
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    const scale = canvas.height / full;

    pos.forEach(y => {
        ctx.beginPath();
        ctx.moveTo(0, y * scale);
        ctx.lineTo(canvas.width, y * scale);
        ctx.strokeStyle = "black";
        ctx.stroke();
    });
}

const kezdoMinEl = document.getElementById("kezdoMin");
const kezdoMaxEl = document.getElementById("kezdoMax");
const lecMinEl = document.getElementById("lecMin");
const lecMaxEl = document.getElementById("lecMax");
const szarufaEl = document.getElementById("szarufa");
const lastDistEl = document.getElementById("lastDist");
</script>

</body>
</html>
